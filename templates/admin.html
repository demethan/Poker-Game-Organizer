{% extends "base.html" %}
{% block content %}
<h1>Admin</h1>
<p>Manage users and their access.</p>
{% if error %}<div class="error">{{ error }}</div>{% endif %}
{% if success %}<div class="notice notice-strong">{{ success }}</div>{% endif %}

<table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Username</th>
      <th>Email</th>
      <th>Games</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for u in users %}
    <tr>
      <td>{{ u['name'] }}</td>
      <td>{{ u['username'] or '-' }}</td>
      <td>{{ u['email'] }}</td>
      <td>{{ u['game_count'] }}</td>
      <td>{{ 'Disabled' if u['is_disabled'] else 'Active' }}</td>
      <td>
        <div class="row">
          {% if not u['is_disabled'] %}
          <form method="post" action="/admin/users/{{ u['id'] }}/disable">
            <input type="hidden" name="csrf_token" value="{{ csrf_token(request) }}">
            <button class="btn secondary" type="submit">Disable</button>
          </form>
          {% else %}
          <form method="post" action="/admin/users/{{ u['id'] }}/enable">
            <input type="hidden" name="csrf_token" value="{{ csrf_token(request) }}">
            <button class="btn secondary" type="submit">Enable</button>
          </form>
          {% endif %}
          <form method="post" action="/admin/users/{{ u['id'] }}/reset">
            <input type="hidden" name="csrf_token" value="{{ csrf_token(request) }}">
            <button class="btn" type="submit">Reset Password</button>
          </form>
          {% if not u['is_admin'] %}
          <form method="post" action="/admin/users/{{ u['id'] }}/delete" onsubmit="return confirm('Delete this user and all their games?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token(request) }}">
            <button class="btn danger" type="submit">Delete</button>
          </form>
          {% endif %}
        </div>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
